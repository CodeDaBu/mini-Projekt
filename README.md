# Sistem za upravljanje radijskih postaj

## Opis

Ta projekt je namenjen upravljanju radijskih postaj, komentarjev in uporabnikov z uporabo Java aplikacije in PostgreSQL baze. Sistem omogoča:

* registracijo in prijavo uporabnikov
* pregled in komentiranje radijskih postaj
* shranjevanje podatkov o radijskih postajah, državah in krajih
* uporabo SQL funkcij in sprožilcev za obdelavo poslovne logike

---

## Struktura tabel

### drzave

```sql
CREATE TABLE IF NOT EXISTS drzave (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ime VARCHAR,
    koda VARCHAR
);
```

### kraj

```sql
CREATE TABLE IF NOT EXISTS kraj (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ime VARCHAR,
    postna_st VARCHAR,
    drzava_id INTEGER REFERENCES drzave
);
```

### radio

```sql
CREATE TABLE IF NOT EXISTS radio (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ime VARCHAR,
    frekvenca DOUBLE PRECISION,
    channel VARCHAR,
    valid_until DATE,
    phone VARCHAR,
    email VARCHAR,
    kraj_id INTEGER REFERENCES kraj,
    comment_count INTEGER DEFAULT 0,
    last_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### users

```sql
CREATE TABLE IF NOT EXISTS users (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR,
    password VARCHAR,
    email VARCHAR,
    phone VARCHAR,
    kraj_id INTEGER REFERENCES kraj,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### comments

```sql
CREATE TABLE IF NOT EXISTS comments (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    comment_text TEXT,
    frequency_id INTEGER REFERENCES radio,
    user_id INTEGER REFERENCES users,
    created_at TIMESTAMP
);
```

---

## SQL funkcije

### check_user_validity

Preveri ali uporabnik z danim uporabniškim imenom in geslom obstaja.

```sql
check_user_validity(p_username TEXT, p_password TEXT) RETURNS BOOLEAN
```

### register_new_user

Registrira novega uporabnika.

```sql
register_new_user(p_username TEXT, p_password TEXT) RETURNS VOID
```

### get_user_id

Vrne ID uporabnika glede na uporabniško ime.

```sql
get_user_id(p_username TEXT) RETURNS INTEGER
```

### prijava_uporabnika

Prijavi uporabnika in vrne njegov ID ali -1 če ne obstaja.

```sql
prijava_uporabnika(p_username TEXT, p_password TEXT) RETURNS INTEGER
```

### registracija_uporabnika

Registrira novega uporabnika, če še ne obstaja.

```sql
registracija_uporabnika(p_username TEXT, p_password TEXT) RETURNS BOOLEAN
```

### pridobi_radio_id

Vrne ID radijske postaje glede na ime.

```sql
pridobi_radio_id(po_ime TEXT) RETURNS INTEGER
```

### pridobi_podrobnosti_radia

Vrne podrobnosti o radijski postaji.

```sql
pridobi_podrobnosti_radia(po_ime TEXT) RETURNS TABLE(...)
```

### dodaj_komentar

Doda nov komentar za radijsko postajo.

```sql
dodaj_komentar(p_comment_text TEXT, p_frequency_id INTEGER, p_user_id INTEGER) RETURNS VOID
```

### count_comments

Prešteje komentarje za določeno radijsko postajo.

```sql
count_comments(radio_id INTEGER) RETURNS INTEGER
```

### pridobi_vse_radio_postaje

Vrne seznam vseh radijskih postaj.

```sql
pridobi_vse_radio_postaje() RETURNS TABLE(...)
```

---

## Sprožilci (Triggerji)

### update_comment_count

Po vnosu komentarja posodobi število komentarjev.

```sql
AFTER INSERT ON comments FOR EACH ROW
EXECUTE PROCEDURE update_comment_count();
```

### update_radio_last_modified

Po vnosu komentarja posodobi last_modified pri radijski postaji.

```sql
AFTER INSERT ON comments FOR EACH ROW
EXECUTE PROCEDURE update_radio_last_modified();
```

### trigger_update_last_modified

Pred posodobitvijo radia posodobi last_modified.

```sql
BEFORE UPDATE ON radio FOR EACH ROW
EXECUTE PROCEDURE update_last_modified();
```

---

## Lastništvo

Vse tabele in funkcije so v lasti uporabnika `postgres`.

---

## Opomba

Celotna poslovna logika je implementirana v PostgreSQL. Java aplikacija služi kot vmesnik za interakcijo z bazo.
